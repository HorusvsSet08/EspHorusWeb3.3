<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Datos en Vivo - Horus</title>
  <link rel="stylesheet" href="../css/style.css" />
  <style>
    /* üé® Estilos para el visor STL */
    .model-viewer-container {
      position: relative;
      width: 80vw;
      height: 70vh;
      margin: 40px auto;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
      background: #000;
    }

    .screenshot-btn {
      position: absolute;
      right: 16px;
      top: 16px;
      z-index: 10;
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border: 1px solid #fff;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      backdrop-filter: blur(8px);
      transition: background 0.2s;
    }

    .screenshot-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .connection-status-small {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      width: fit-content;
      margin: 20px auto;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: orange;
      display: inline-block;
    }

    .status-text {
      font-weight: bold;
    }

    .last-update {
      font-size: 0.8em;
      opacity: 0.8;
    }
  </style>
</head>
<body class="light-mode">
  <nav class="nav">
    <div class="nav-container">
      <div class="nav-buttons">
        <a href="../index.html" class="nav-btn">
          <span class="nav-icon">üè†</span> Inicio
        </a>
        <a href="mqtt.html" class="nav-btn active">
          <span class="nav-icon">üì°</span> Datos en Vivo
        </a>
        <a href="analisis.html" class="nav-btn">
          <span class="nav-icon">üìä</span> An√°lisis
        </a>
        <a href="chatbot.html" class="nav-btn">
          <span class="nav-icon">ü§ñ</span> Chatbot
        </a>
      </div>

      <div class="nav-right">
        <label class="theme-switch">
          <input type="checkbox" class="theme-switch__checkbox">
          <div class="theme-switch__container">
            <div class="theme-switch__clouds"></div>
            <div class="theme-switch__stars-container">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 144 55" fill="none">
                <path d="M135.831 3.00688C135.055 3.85027 134.111 4.29946 133 4.35447C134.111 4.40947 135.055 4.85867 135.831 5.71123C136.607 6.55462 136.996 7.56303 136.996 8.72727C136.996 7.95722 137.172 7.25134 137.525 6.59129C137.886 5.93124 138.372 5.39954 138.98 5.00535C139.598 4.60199 140.268 4.39114 141 4.35447C139.88 4.2903 138.936 3.85027 138.16 3.00688C137.384 2.16348 136.996 1.16425 136.996 0C136.996 1.16425 136.607 2.16348 135.831 3.00688Z" fill="currentColor"/>
              </svg>
            </div>
            <div class="theme-switch__circle-container">
              <div class="theme-switch__sun-moon-container">
                <div class="theme-switch__moon">
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                </div>
              </div>
            </div>
          </div>
        </label>
      </div>
    </div>
  </nav>

  <!-- Estado de conexi√≥n -->
  <div class="connection-status-small">
    <span class="status-dot"></span>
    <span class="status-text">Conectando...</span>
    <div class="last-update">√∫ltima: nunca</div>
  </div>

  <div class="container">
    <header>
      <h1>üì° Visor 3D - Modelo Horus</h1>
      <p class="dashboard-description">Visualizaci√≥n 3D del modelo STL en tiempo real</p>
    </header>

    <!-- üîπ VISOR STL AQU√ç -->
    <div class="model-viewer-container" id="stl-container">
      <button class="screenshot-btn" id="captureBtn">üì∏ Captura</button>
    </div>

    <footer>
      <p>Estaci√≥n Horus ‚Ä¢ Dise√±o y desarrollo por <strong>Tu Nombre</strong></p>
      <p class="disclaimer">Modelo STL cargado desde carpeta local <code>/stl/1.stl</code></p>
    </footer>
  </div>

  <!-- üß† SCRIPT DEL VISOR STL -->
  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";
    import { STLLoader } from "https://unpkg.com/three@0.160.0/examples/jsm/loaders/STLLoader.js";

    const container = document.getElementById("stl-container");
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0a0a0a);

    const camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 100);
    camera.position.set(0, 0.3, 2);

    const renderer = new THREE.WebGLRenderer({ antialias: true, preserveDrawingBuffer: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    // üí° Luces
    const ambient = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambient);
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(3, 3, 3);
    scene.add(dirLight);

    // üéÆ Control de c√°mara
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    // üì¶ Cargar modelo STL (ruta relativa)
    const loader = new STLLoader();
    const modelPath = "../../stl/1.stl"; // üëà el modelo est√° al mismo nivel que /html/
    loader.load(
      modelPath,
      (geometry) => {
        const material = new THREE.MeshStandardMaterial({ color: 0x87ceeb, metalness: 0.2, roughness: 0.5 });
        const mesh = new THREE.Mesh(geometry, material);
        geometry.computeBoundingBox();
        const center = new THREE.Vector3();
        geometry.boundingBox.getCenter(center);
        mesh.position.sub(center);
        scene.add(mesh);
      },
      (xhr) => console.log(`Cargando modelo: ${(xhr.loaded / xhr.total * 100).toFixed(0)}%`),
      (error) => console.error("‚ùå Error al cargar STL:", error)
    );

    // üì∏ Captura de pantalla
    document.getElementById("captureBtn").addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "captura_modelo.png";
      link.href = renderer.domElement.toDataURL("image/png");
      link.click();
    });

    // üîÑ Animaci√≥n
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    // üìè Responsividad
    window.addEventListener("resize", () => {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });
  </script>

  <!-- Tema y efectos generales -->
  <script src="../js/main.js"></script>
</body>
</html>
